# Feishu x OpenCode Bridge âœ¨ğŸ¤–âœ¨

[![Node.js >= 20](https://img.shields.io/badge/Node.js-%3E%3D20-339933?logo=node.js&logoColor=white)](https://nodejs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.x-3178C6?logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![License: GPLv3](https://img.shields.io/badge/License-GPLv3-blue.svg)](https://www.gnu.org/licenses/gpl-3.0)

æŠŠæœ¬åœ° OpenCode ç›´æ¥æ¥è¿›é£ä¹¦ç¾¤èŠï¼š@æœºå™¨äººå³å¯å¯¹è¯ï¼Œæ”¯æŒæµå¼è¾“å‡ºã€æ€è€ƒæŠ˜å å¡ç‰‡ã€æƒé™ç¡®è®¤ã€question æé—®ä¸ `/undo` ä¸€è‡´å›æ»šã€‚

æ–°æ—¶ä»£äº†ï¼Œè®© AI ä»£ç†è‡ªåŠ¨éƒ¨ç½²å§ï¼šè¯·åœ¨ OpenCode æ‰§è¡Œå¦‚ä¸‹æŒ‡ä»¤ï¼š
```bash
è¯·é˜…è¯» https://github.com/HNGM-HP/feishu-opencode-bridge/blob/main/AI_Deployment_Guide.md æ–‡æ¡£å¹¶å®‰è£…ç¨‹åº
```

## ğŸ“‹ ç›®å½•

- [ä¸ºä»€ä¹ˆç”¨å®ƒ](#ä¸ºä»€ä¹ˆç”¨å®ƒ)
- [èƒ½åŠ›æ€»è§ˆ](#èƒ½åŠ›æ€»è§ˆ)
- [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [éƒ¨ç½²ä¸è¿ç»´](#éƒ¨ç½²ä¸è¿ç»´)
- [ç¯å¢ƒå˜é‡](#ç¯å¢ƒå˜é‡)
- [é£ä¹¦åå°é…ç½®](#é£ä¹¦åå°é…ç½®)
- [å‘½ä»¤é€ŸæŸ¥](#å‘½ä»¤é€ŸæŸ¥)
- [å…³é”®å®ç°ç»†èŠ‚](#å…³é”®å®ç°ç»†èŠ‚)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

## ğŸ’¡ä¸ºä»€ä¹ˆç”¨å®ƒ

- ğŸ’– ä¸ä»â€œé›¶â€å¼€å§‹ï¼šä¸éœ€è¦ä½ å†æ¬¡é…ç½®ã€æ„å»ºæ–°çš„é¡¹ç›®ï¼Œä¸å¢åŠ å­¦ä¹ æˆæœ¬ï¼Œä¸å¢åŠ è®¾å¤‡æˆæœ¬ã€‚
- ğŸ’¬ é£ä¹¦ä¾§ç»Ÿä¸€å…¥å£ï¼šç¾¤é‡Œç›´æ¥å¯¹è¯ï¼Œä¸ç”¨åˆ‡åˆ° OpenCode WebUIã€‚
- ğŸ‘¥ å¤šè½®ä¸Šä¸‹æ–‡å¯æŒç»­ï¼šç¾¤èŠå’Œ OpenCode session æŒä¹…ç»‘å®šï¼Œé‡å¯åå¯ç»§ç»­ã€‚
- ğŸ“‹ äº¤äº’é—­ç¯ï¼šAI è¦æƒé™ã€è¦æé—®æ—¶ï¼Œå…¨éƒ¨èµ°é£ä¹¦å¡ç‰‡ï¼Œä¸ä¸¢ä¸Šä¸‹æ–‡ã€‚
- ğŸ³ å¯¹ç”Ÿäº§å‹å¥½ï¼šæä¾› Node è„šæœ¬ + Linux systemd èœå•åŒ–éƒ¨ç½²æ–¹å¼ã€‚

## ğŸ“¸ èƒ½åŠ›æ€»è§ˆ

| èƒ½åŠ› | è¯´æ˜ |
|---|---|
| ç¾¤èŠå¯¹è¯ | @æœºå™¨äººæˆ–å›å¤æœºå™¨äººæ¶ˆæ¯ï¼Œè‡ªåŠ¨è½¬å‘åˆ° OpenCode ä¼šè¯ |
| ç§èŠå»ºç¾¤ | ç§èŠç‚¹å‡»å¡ç‰‡ä¸€é”®åˆ›å»ºä¼šè¯ç¾¤å¹¶ç»‘å®š session æ³¨æ„ï¼ç§èŠæ— æ³•åšä¼šè¯éš”ç¦»ï¼Œæ‰€ä»¥å”¯ä¸€ä½œç”¨å°±åªèƒ½æ˜¯å»ºç¾¤ï¼ |
| Agent è§’è‰² | æ”¯æŒå†…ç½®ä¸è‡ªå®šä¹‰è§’è‰²ï¼›å¯åœ¨å½“å‰ç¾¤é€šè¿‡ `/panel` æˆ– `/agent` è‡ªç”±åˆ‡æ¢ |
| æµå¼è¾“å‡º | è¾“å‡ºç¼“å†²å®šæ—¶åˆ·æ–°ï¼›æ£€æµ‹åˆ° thinking/reasoning è‡ªåŠ¨åˆ‡å¡ç‰‡ |
| æ€è€ƒæŠ˜å  | æ”¯æŒå±•å¼€/æŠ˜å æ€è€ƒå†…å®¹ï¼Œé¿å…é•¿å¡ç‰‡åˆ·å± |
| æƒé™ç¡®è®¤ | `permission.asked` è‡ªåŠ¨å‘ç¡®è®¤å¡ï¼Œæ”¯æŒä¸€æ¬¡/å§‹ç»ˆ/æ‹’ç» |
| AI æé—® | `question.asked` ç”Ÿæˆé—®ç­”å¡ï¼Œæ”¯æŒå•é€‰/å¤šé€‰/è‡ªå®šä¹‰/è·³è¿‡ |
| ä¸€è‡´æ’¤å› | `/undo` åŒæ—¶å›æ»š OpenCode å’Œé£ä¹¦æ¶ˆæ¯ï¼Œé—®ç­”åœºæ™¯æ”¯æŒé€’å½’å›æ»š |
| é™„ä»¶è½¬å‘ | æ”¯æŒé£ä¹¦å›¾ç‰‡/æ–‡ä»¶ï¼Œä¸‹è½½åæŒ‰ OpenCode file part å‘é€ |

## ğŸ“Œ æ¶æ„æ¦‚è§ˆ

```mermaid
flowchart LR
  U[é£ä¹¦ç”¨æˆ·] --> F[é£ä¹¦ç¾¤èŠ/ç§èŠ]
  F --> B[æ¡¥æ¥æœåŠ¡]
  B --> O[OpenCode Server]
  O --> B
  B --> C[é£ä¹¦å¡ç‰‡ä¸æ¶ˆæ¯æ›´æ–°]
  B <--> S[.chat-sessions.json]
```

å…³é”®ç‚¹ï¼š

- `sessionId -> chatId` æ˜ å°„ç”¨äºæƒé™/æé—®å›è·¯ç”±ã€‚
- è¾“å‡ºç¼“å†²å±‚è´Ÿè´£èŠ‚æµæ›´æ–°ï¼Œé¿å…é«˜é¢‘ patch è§¦å‘é™åˆ¶ã€‚
- æ–‡æœ¬ä¸å¡ç‰‡å±äºä¸¤ç§æ¶ˆæ¯ç±»å‹ï¼Œå¿…è¦æ—¶ä¼šåˆ æ—§æ¶ˆæ¯å¹¶é‡å‘å¡ç‰‡ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1) å‰ç½®è¦æ±‚

- Node.js >= 20
- æœ¬æœºå¯è¿è¡Œ OpenCodeï¼ˆæ”¯æŒ `opencode serve`ï¼‰
- é£ä¹¦å¼€æ”¾å¹³å°åº”ç”¨ï¼ˆæœºå™¨äºº + äº‹ä»¶è®¢é˜… + å¯¹åº”æƒé™ï¼‰

### 2) å¯åŠ¨ OpenCode

```bash
opencode serve --port 4096
```
- æ–°ç‰ˆæœ¬å¸¦å‚æ•°å¯åŠ¨opencode ä¸å†æ˜¾ç¤ºCLIç•Œé¢ï¼Œå¦‚æœä½ å¸Œæœ›åŒæ—¶å±•ç¤ºï¼Œè¯·å‚è€ƒä¸‹æ–¹æ–¹æ³•ï¼›

- æç¤ºï¼ˆæ¨èï¼‰ï¼š OpenCode è£¸å¯åŠ¨ï¼ˆä¸å¸¦ `serve --port` å‚æ•°ï¼‰ï¼Œå¯ä»¥åœ¨ OpenCode é…ç½®æ–‡ä»¶ `opencode.json` çš„æ ¹å¯¹è±¡ä¸­æ·»åŠ /åˆå¹¶ `server` å­—æ®µï¼š

```json
"server": {
  "port": 4096,
  "hostname": "0.0.0.0",
  "cors": [
    "*"
  ]
}
```

é…ç½®åå¯ç›´æ¥è¿è¡Œï¼š

```bash
opencode
```

å¦‚æœç”± AI ä»£ç†æ‰§è¡Œéƒ¨ç½²ï¼Œå»ºè®®å…ˆè¯¢é—®ç”¨æˆ·æ˜¯å¦éœ€è¦å†™å…¥è¿™æ®µé…ç½®ï¼Œå†è¿›è¡Œä¿®æ”¹ã€‚

### 3) é…ç½®ç¯å¢ƒå˜é‡

```bash
cp .env.example .env
```

è‡³å°‘å¡«å†™ï¼š

- `FEISHU_APP_ID`
- `FEISHU_APP_SECRET`

### 4) å¯åŠ¨æ¡¥æ¥æœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼‰

```bash
npm install
npm run dev
```

## ğŸ’» éƒ¨ç½²ä¸è¿ç»´

### npm å‘½ä»¤

| ç›®æ ‡ | å‘½ä»¤ | è¯´æ˜ |
|---|---|---|
| ä¸€é”®éƒ¨ç½² | `npm run deploy:bridge` | å®‰è£…ä¾èµ–å¹¶ç¼–è¯‘ |
| ç®¡ç†èœå• | `npm run manage:bridge` | äº¤äº’å¼èœå•ï¼ˆé»˜è®¤å…¥å£ï¼‰ |
| å¯åŠ¨åå° | `npm run start:bridge` | åå°å¯åŠ¨ï¼ˆè‡ªåŠ¨æ£€æµ‹/è¡¥æ„å»ºï¼‰ |
| åœæ­¢åå° | `npm run stop:bridge` | æŒ‰ PID åœæ­¢åå°è¿›ç¨‹ |

### è·¨å¹³å°è„šæœ¬å…¥å£

| å¹³å° | ç®¡ç†èœå• | å¯åŠ¨ | åœæ­¢ |
|---|---|---|---|
| Linux/macOS | `./scripts/deploy.sh menu` | `./scripts/start.sh` | `./scripts/stop.sh` |
| Windows CMD | `scripts\\deploy.cmd menu` | `scripts\\start.cmd` | `scripts\\stop.cmd` |
| PowerShell | `.\\scripts\\deploy.ps1 menu` | `.\\scripts\\start.ps1` | `.\\scripts\\stop.ps1` |

### Linux å¸¸é©»ï¼ˆsystemdï¼‰

ç®¡ç†èœå•å†…æä¾›ä»¥ä¸‹æ“ä½œï¼š

- å®‰è£…å¹¶å¯åŠ¨ systemd æœåŠ¡
- åœæ­¢å¹¶ç¦ç”¨ systemd æœåŠ¡
- å¸è½½ systemd æœåŠ¡
- æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

ä¹Ÿå¯ä»¥ç›´æ¥å‘½ä»¤è¡Œè°ƒç”¨ï¼š

```bash
sudo node scripts/deploy.mjs service-install
sudo node scripts/deploy.mjs service-disable
sudo node scripts/deploy.mjs service-uninstall
node scripts/deploy.mjs status
```

æ—¥å¿—é»˜è®¤åœ¨ `logs/service.log` å’Œ `logs/service.err`ã€‚

## âš™ï¸ ç¯å¢ƒå˜é‡

ä»¥ `src/config.ts` å®é™…è¯»å–ä¸ºå‡†ï¼š

| å˜é‡ | å¿…å¡« | é»˜è®¤å€¼ | è¯´æ˜ |
|---|---|---|---|
| `FEISHU_APP_ID` | æ˜¯ | - | é£ä¹¦åº”ç”¨ App ID |
| `FEISHU_APP_SECRET` | æ˜¯ | - | é£ä¹¦åº”ç”¨ App Secret |
| `OPENCODE_HOST` | å¦ | `localhost` | OpenCode åœ°å€ |
| `OPENCODE_PORT` | å¦ | `4096` | OpenCode ç«¯å£ |
| `ALLOWED_USERS` | å¦ | ç©º | é£ä¹¦ open_id ç™½åå•ï¼Œé€—å·åˆ†éš”ï¼›ä¸ºç©ºæ—¶ä¸å¯ç”¨ç™½åå• |
| `DEFAULT_PROVIDER` | å¦ | `openai` | é»˜è®¤æ¨¡å‹æä¾›å•† |
| `DEFAULT_MODEL` | å¦ | `gpt-5.2` | é»˜è®¤æ¨¡å‹ |
| `TOOL_WHITELIST` | å¦ | `Read,Glob,Grep,Task` | è‡ªåŠ¨æ”¾è¡Œæƒé™æ ‡è¯†åˆ—è¡¨ |
| `OUTPUT_UPDATE_INTERVAL` | å¦ | `3000` | è¾“å‡ºåˆ·æ–°é—´éš”ï¼ˆmsï¼‰ |
| `ATTACHMENT_MAX_SIZE` | å¦ | `52428800` | é™„ä»¶å¤§å°ä¸Šé™ï¼ˆå­—èŠ‚ï¼‰ |

æ³¨æ„ï¼š`TOOL_WHITELIST` åšå­—ç¬¦ä¸²åŒ¹é…ï¼Œæƒé™äº‹ä»¶å¯èƒ½ä½¿ç”¨ `permission` å­—æ®µå€¼ï¼ˆä¾‹å¦‚ `external_directory`ï¼‰ï¼Œè¯·æŒ‰å®é™…æ ‡è¯†é…ç½®ã€‚

`ALLOWED_USERS` è¯´æ˜ï¼š

- æœªé…ç½®æˆ–ç•™ç©ºï¼šä¸å¯ç”¨ç™½åå•ï¼›ç”Ÿå‘½å‘¨æœŸæ¸…ç†ä»…åœ¨ç¾¤æˆå‘˜æ•°ä¸º `0` æ—¶æ‰ä¼šè‡ªåŠ¨è§£æ•£ç¾¤èŠã€‚
- å·²é…ç½®ï¼šå¯ç”¨ç™½åå•ä¿æŠ¤ï¼›å½“ç¾¤æˆå‘˜ä¸è¶³ä¸”ç¾¤å†…/ç¾¤ä¸»éƒ½ä¸åœ¨ç™½åå•æ—¶ï¼Œæ‰ä¼šè‡ªåŠ¨è§£æ•£ã€‚

## âš™ï¸ é£ä¹¦åå°é…ç½®

å»ºè®®ä½¿ç”¨é•¿è¿æ¥æ¨¡å¼ï¼ˆWebSocket äº‹ä»¶ï¼‰ã€‚

### äº‹ä»¶è®¢é˜…ï¼ˆæŒ‰ä»£ç å·²æ³¨å†Œé¡¹ï¼‰

| äº‹ä»¶ | å¿…éœ€ | ç”¨é€” |
|---|---|---|
| `im.message.receive_v1` | æ˜¯ | æ¥æ”¶ç¾¤èŠ/ç§èŠæ¶ˆæ¯ |
| `im.message.recalled_v1` | æ˜¯ | ç”¨æˆ·æ’¤å›è§¦å‘ `/undo` å›æ»š |
| `im.chat.member.user.deleted_v1` | æ˜¯ | æˆå‘˜é€€ç¾¤åè§¦å‘ç”Ÿå‘½å‘¨æœŸæ¸…ç† |
| `im.chat.disbanded_v1` | æ˜¯ | ç¾¤è§£æ•£åæ¸…ç†æœ¬åœ°ä¼šè¯æ˜ å°„ |
| `card.action.trigger` | æ˜¯ | å¤„ç†æ§åˆ¶é¢æ¿ã€æƒé™ç¡®è®¤ã€æé—®å¡ç‰‡å›è°ƒ |
| `im.message.message_read_v1` | å¦ | å·²è¯»å›æ‰§å…¼å®¹ï¼ˆå¯ä¸å¼€å¯ï¼‰ |

### åº”ç”¨æƒé™ï¼ˆæŒ‰å®é™…è°ƒç”¨æ¥å£æ¢³ç†ï¼‰

| èƒ½åŠ›åˆ†ç»„ | ä»£ç ä¸­è°ƒç”¨çš„æ¥å£ | ç”¨é€” |
|---|---|---|
| æ¶ˆæ¯è¯»å†™ä¸æ’¤å›ï¼ˆ`im:message`ï¼‰ | `im.message.create` / `im.message.reply` / `im.message.patch` / `im.message.delete` | å‘é€æ–‡æœ¬/å¡ç‰‡ã€æµå¼æ›´æ–°å¡ç‰‡ã€æ’¤å›æ¶ˆæ¯ |
| æ¶ˆæ¯èµ„æºä¸‹è½½ï¼ˆ`im:resource`ï¼‰ | `im.messageResource.get` | ä¸‹è½½å›¾ç‰‡/æ–‡ä»¶é™„ä»¶å¹¶è½¬å‘ç»™ OpenCode |
| ç¾¤ä¸æˆå‘˜ç®¡ç†ï¼ˆ`im:chat`ï¼‰ | `im.chat.create` / `im.chat.delete` / `im.chat.list` / `im.chat.get` / `im.chatMembers.get` / `im.chatMembers.create` | ç§èŠå»ºç¾¤ã€æ‹‰äººè¿›ç¾¤ã€æŸ¥ç¾¤æˆå‘˜ã€è‡ªåŠ¨æ¸…ç†æ— æ•ˆç¾¤ |
| ç¾¤ç®¡ç†å‘˜è®¾ç½®ï¼ˆå¯é€‰ï¼‰ | `im.chatManagers.addManagers` | é¢„ç•™èƒ½åŠ›ï¼Œå½“å‰æµç¨‹é»˜è®¤ä¸ä¾èµ– |

æ³¨æ„ï¼šé£ä¹¦åå°ä¸åŒç‰ˆæœ¬çš„æƒé™åç§°å¯èƒ½ç•¥æœ‰å·®å¼‚ï¼ŒæŒ‰ä¸Šè¡¨æ¥å£èƒ½åŠ›é€é¡¹å¯¹é½å³å¯ï¼›è‹¥åªéœ€æ–‡æœ¬å¯¹è¯ä¸”ä¸å¤„ç†é™„ä»¶ï¼Œå¯æš‚ä¸å¼€å¯ `im:resource`ã€‚
- å¯ä»¥å¤åˆ¶ä¸‹æ–¹å‚æ•°ä¿å­˜è‡³qx.jsonï¼Œç„¶ååœ¨é£ä¹¦`å¼€å‘è€…åå°`--`æƒé™ç®¡ç†`--`æ‰¹é‡å¯¼å…¥/å¯¼å‡ºæƒé™`
```json
{
  "scopes": {
    "tenant": [
      "im:message.p2p_msg:readonly",
      "im:chat",
      "im:chat.members:read",
      "im:chat.members:write_only",
      "im:message",
      "im:message.group_at_msg:readonly",
      "im:message.group_msg",
      "im:message.reactions:read",
      "im:message.reactions:write_only",
      "im:resource"
    ],
    "user": []
  }
}
```

## ğŸ“– å‘½ä»¤é€ŸæŸ¥

| å‘½ä»¤ | è¯´æ˜ |
|---|---|
| `/help` | æŸ¥çœ‹å¸®åŠ© |
| `/panel` | æ‰“å¼€æ§åˆ¶é¢æ¿ï¼ˆæ¨¡å‹ã€Agentã€åœæ­¢ã€æ’¤å›ï¼‰ |
| `/model` | æŸ¥çœ‹å½“å‰æ¨¡å‹ |
| `/model <provider:model>` | åˆ‡æ¢æ¨¡å‹ï¼ˆæ”¯æŒ `provider/model`ï¼‰ |
| `/agent` | æŸ¥çœ‹å½“å‰ Agent |
| `/agent <name>` | åˆ‡æ¢ Agent |
| `/agent off` | å…³é—­ Agentï¼Œå›åˆ°é»˜è®¤ |
| `/role create <è§„æ ¼>` | æ–œæ å½¢å¼åˆ›å»ºè‡ªå®šä¹‰è§’è‰² |
| `åˆ›å»ºè§’è‰² åç§°=...; æè¿°=...; ç±»å‹=...; å·¥å…·=...` | è‡ªç„¶è¯­è¨€åˆ›å»ºè‡ªå®šä¹‰è§’è‰²å¹¶åˆ‡æ¢ |
| `/stop` | ä¸­æ–­å½“å‰ä¼šè¯æ‰§è¡Œ |
| `/undo` | æ’¤å›ä¸Šä¸€è½®äº¤äº’ï¼ˆOpenCode + é£ä¹¦åŒæ­¥ï¼‰ |
| `/session new` | æ–°å»ºä¼šè¯å¹¶é‡ç½®ä¸Šä¸‹æ–‡ |
| `/clear` | ç­‰ä»·äº `/session new` |
| `/clear free session` | æ¸…ç†ç©ºé—²ç¾¤èŠå’Œä¼šè¯ |
| `/status` | æŸ¥çœ‹å½“å‰ç¾¤ç»‘å®šçŠ¶æ€ |

## ğŸ¤– Agentï¼ˆè§’è‰²ï¼‰ä½¿ç”¨

### 1) æŸ¥çœ‹ä¸åˆ‡æ¢

- æ¨èä½¿ç”¨ `/panel` å¯è§†åŒ–åˆ‡æ¢è§’è‰²ï¼ˆå½“å‰ç¾¤å³æ—¶ç”Ÿæ•ˆï¼‰ã€‚
- ä¹Ÿå¯ç”¨å‘½ä»¤ï¼š`/agent`ï¼ˆæŸ¥çœ‹å½“å‰ï¼‰ã€`/agent <name>`ï¼ˆåˆ‡æ¢ï¼‰ã€`/agent off`ï¼ˆå›åˆ°é»˜è®¤ï¼‰ã€‚

### 2) è‡ªå®šä¹‰ Agent

- æ”¯æŒè‡ªç„¶è¯­è¨€ç›´æ¥åˆ›å»ºå¹¶åˆ‡æ¢ï¼š

```text
åˆ›å»ºè§’è‰² åç§°=æ—…è¡ŒåŠ©æ‰‹; æè¿°=æ“…é•¿åˆ¶å®šæ—…è¡Œè®¡åˆ’; ç±»å‹=ä¸»; å·¥å…·=webfetch; æç¤ºè¯=å…ˆè¯¢é—®é¢„ç®—å’Œæ—¶é—´ï¼Œå†ç»™ä¸‰å¥—æ–¹æ¡ˆ
```

- ä¹Ÿæ”¯æŒæ–œæ å½¢å¼ï¼š

```text
/role create åç§°=ä»£ç å®¡æŸ¥å‘˜; æè¿°=å…³æ³¨å¯ç»´æŠ¤æ€§å’Œå®‰å…¨; ç±»å‹=å­; å·¥å…·=read,grep; æç¤ºè¯=å…ˆåˆ—é£é™©ï¼Œå†ç»™æœ€å°æ”¹åŠ¨å»ºè®®
```

- `ç±»å‹` æ”¯æŒ `ä¸»/å­`ï¼ˆæˆ– `primary/subagent`ï¼‰ã€‚

### 3) é…ç½®é»˜è®¤ Agentï¼ˆæé†’ï¼‰

- å¯åœ¨ OpenCode é…ç½®æ–‡ä»¶ `opencode.json` è®¾ç½® `default_agent`ã€‚
- å½“æ¡¥æ¥ä¾§æœªæ˜¾å¼æŒ‡å®šè§’è‰²æ—¶ï¼Œä¼šè·Ÿéš OpenCode çš„é»˜è®¤ Agentã€‚

```json
{
  "$schema": "https://opencode.ai/config.json",
  "default_agent": "companion"
}
```

- ä¿®æ”¹åå¦‚æœ `/panel` æœªç«‹å³æ˜¾ç¤ºæ–°è§’è‰²ï¼Œé‡å¯ OpenCode å³å¯ã€‚

## ğŸ“Œ å…³é”®å®ç°ç»†èŠ‚

### 1) æƒé™è¯·æ±‚å›ä¼ 

- `permission.asked` é‡Œ `tool` å¯èƒ½ä¸æ˜¯å­—ç¬¦ä¸²å·¥å…·åï¼Œå®é™…ç™½åå•åŒ¹é…å¯è½åœ¨ `permission` å­—æ®µã€‚
- å›ä¼ æ¥å£è¦æ±‚ `response` ä¸º `once | always | reject`ï¼Œä¸æ˜¯ `allow | deny`ã€‚

### 2) question å·¥å…·äº¤äº’

- é—®é¢˜æ¸²æŸ“ä¸ºé£ä¹¦å¡ç‰‡ï¼Œç­”æ¡ˆé€šè¿‡ç”¨æˆ·æ–‡å­—å›å¤è§£æã€‚
- è§£æåæŒ‰ OpenCode éœ€è¦çš„ `answers: string[][]` å›ä¼ ï¼Œå¹¶çº³å…¥æ’¤å›å†å²ã€‚

### 3) æµå¼ä¸æ€è€ƒå¡ç‰‡

- æ–‡æœ¬ä¸æ€è€ƒåˆ†æµå†™å…¥è¾“å‡ºç¼“å†²ï¼›å‡ºç°æ€è€ƒå†…å®¹æ—¶è‡ªåŠ¨åˆ‡æ¢å¡ç‰‡æ¨¡å¼ã€‚
- å¡ç‰‡æ”¯æŒå±•å¼€/æŠ˜å æ€è€ƒï¼Œæœ€ç»ˆæ€ä¿ç•™å®ŒæˆçŠ¶æ€ã€‚

### 4) `/undo` ä¸€è‡´æ€§

- éœ€è¦åŒæ—¶åˆ é™¤é£ä¹¦ä¾§æ¶ˆæ¯å¹¶å¯¹ OpenCode æ‰§è¡Œ `revert`ã€‚
- é—®ç­”åœºæ™¯å¯èƒ½æ¶‰åŠå¤šæ¡å…³è”æ¶ˆæ¯ï¼Œä½¿ç”¨é€’å½’å›æ»šå…œåº•ã€‚

## ğŸ› ï¸ æ•…éšœæ’æŸ¥

| ç°è±¡ | ä¼˜å…ˆæ£€æŸ¥ |
|---|---|
| ç‚¹æƒé™å¡ç‰‡å OpenCode æ— ååº” | æ—¥å¿—æ˜¯å¦å‡ºç°æƒé™å›ä¼ å¤±è´¥ï¼›ç¡®è®¤å›ä¼ å€¼æ˜¯ `once/always/reject` |
| æƒé™å¡æˆ–æé—®å¡å‘ä¸åˆ°ç¾¤ | `.chat-sessions.json` ä¸­ `sessionId -> chatId` æ˜ å°„æ˜¯å¦å­˜åœ¨ |
| å¡ç‰‡æ›´æ–°å¤±è´¥ | æ¶ˆæ¯ç±»å‹æ˜¯å¦åŒ¹é…ï¼›å¤±è´¥åæ˜¯å¦é™çº§ä¸ºé‡å‘å¡ç‰‡ |
| åå°æ¨¡å¼æ— æ³•åœæ­¢ | `logs/bridge.pid` æ˜¯å¦æ®‹ç•™ï¼›ä½¿ç”¨ `npm run stop:bridge` æ¸…ç† |
| ç§èŠä¸€ç›´å‘ä½ å¥½ | ç§èŠæ— æ³•åšä¼šè¯éš”ç¦»ï¼Œæ‰€ä»¥ç§èŠçš„åŠŸèƒ½å°±æ˜¯åˆ›å»ºæ–°ä¼šè¯ç¾¤ |
## ğŸ“ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [GNU General Public License v3.0](LICENSE)

**GPL v3 æ„å‘³ç€ï¼š**
- âœ… å¯è‡ªç”±ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘
- âœ… å¯ç”¨äºå•†ä¸šç›®çš„
- ğŸ“ å¿…é¡»å¼€æºä¿®æ”¹ç‰ˆæœ¬
- ğŸ“ å¿…é¡»ä¿ç•™åŸä½œè€…ç‰ˆæƒ
- ğŸ“ è¡ç”Ÿä½œå“å¿…é¡»ä½¿ç”¨ GPL v3 åè®®

å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹ä½ æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ª â­ï¸ Starï¼
